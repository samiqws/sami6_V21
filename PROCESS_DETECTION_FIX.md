# ุฅุตูุงุญ ูุดู ุงูุนูููุฉ (Process Detection Fix)

## ุงููุดููุฉ ุงูุณุงุจูุฉ โ
```
Process: FileSystem (PID: 0)
```
ุงููุธุงู ูู ููู ูุณุชุทูุน ุชุญุฏูุฏ ุงูุนูููุฉ ุงูุญููููุฉ ุงููุณุคููุฉ ุนู ุชุนุฏูู ุงููููุงุช.

## ุงูุณุจุจ
ุงูุนูููุงุช (ูุซู `python.exe` ุงูุชู ุชุดุบู ุงูููุฑูุณ) ุชูุชุญ ุงูููู ููุฏุฉ ุฌุฒุก ูู ุงูุซุงููุฉ ุซู ุชุบููู ุจุณุฑุนุฉ. 
ุนูุฏูุง ููุญุต ุงููุธุงู ุงูุนูููุงุชุ ูููู ุงูููู ูุฏ ุฃูุบูู ุจุงููุนู.

---

## ุงูุญู ุงููุทุจู โ

ุชู ุชุทููุฑ ูุธุงู ูุดู ุฐูู ูุชุนุฏุฏ ุงูุทุจูุงุช:

### 1๏ธโฃ Method 1: ุงููุดู ุงููุจุงุดุฑ
```python
# ูุญุต ุงูุนูููุงุช ุงูุชู ูุฏููุง ุงูููู ููุชูุญ ุญุงููุงู
for proc in psutil.process_iter(['pid', 'name', 'exe', 'cwd']):
    for item in proc.open_files():
        if item.path == file_path:
            return proc  # โ ูุฌุฏูุง ุงูุนูููุฉ!
```

### 2๏ธโฃ Method 2: ุงููุดู ุงูุณูุงูู (Context Detection)
```python
# ุงูุจุญุซ ุนู ุงูุนูููุงุช ุงููุดุจููุฉ ูู ููุณ ุงููุฌูุฏ
suspicious_processes = []

for proc in psutil.process_iter():
    # ูู ุงูุนูููุฉ ุชุนูู ูู ููุณ ุงููุฌูุฏุ
    if proc.cwd == file_directory:
        suspicious_processes.append(proc)  # Score: 3 (ุนุงูู)
    
    # ูู ุงุณู ุงูุนูููุฉ ูุดุจููุ
    if proc.name in ['python.exe', 'powershell.exe', 'cmd.exe']:
        suspicious_processes.append(proc)  # Score: 2 (ูุชูุณุท)

# ุฅุฑุฌุงุน ุงูุนูููุฉ ุงูุฃูุซุฑ ุงุญุชูุงูุงู
return highest_score_process
```

### 3๏ธโฃ Method 3: ุงูุฐุงูุฑุฉ ุงูููุฌูุฉ (Directory Memory)
```python
# ุญูุธ ุขุฎุฑ ุนูููุฉ ูุนุฑููุฉ ููู ูุฌูุฏ
self.last_process_per_dir[directory] = process_info

# ุนูุฏ ุงูุดูุ ุงุณุชุฎุฏู ุขุฎุฑ ุนูููุฉ ูุนุฑููุฉ (ุฅุฐุง ูุงูุช ูุง ุชุฒุงู ููุฏ ุงูุชุดุบูู)
if directory in self.last_process_per_dir:
    last_proc = self.last_process_per_dir[directory]
    if process_still_running(last_proc):
        return last_proc  # โ ุนูู ุงูุฃุฑุฌุญ ููุณ ุงูุนูููุฉ
```

### 4๏ธโฃ ุงูุชุฎุฒูู ุงููุคูุช ุงูุฐูู (Smart Caching)
```python
# Cache by directory instead of individual file
cache_key = file_directory  # ุจุฏูุงู ูู file_path

# Cache time: 2 seconds (ูุตูุฑุฉ ููุฏูุฉ)
if cached_time < 2_seconds_ago:
    return cached_process
```

---

## ุงููุชูุฌุฉ

### ูุจู ุงูุชุญุณูู โ
```
๐จ RANSOMWARE THREAT DETECTED!
Process: FileSystem (PID: 0)
```

### ุจุนุฏ ุงูุชุญุณูู โ
```
๐จ RANSOMWARE THREAT DETECTED!
Process: python.exe (PID: 12345)
Process Path: C:\Users\User\Desktop\virus.exe
Threat Score: 65/100
```

---

## ููู ูุนูู ุงููุธุงู ุงูุขู

### ุณููุงุฑูู 1: ุงูููุฑูุณ ูุนุฏู ูููุงุช ุจุณุฑุนุฉ
```
1. ููู ุชู ุชุนุฏููู: C:\Users\User\Desktop\test.txt
2. Method 1: ุงูุนูููุฉ ุฃุบููุช ุงูููู ุจุงููุนู โ
3. Method 2: ุงูุจุญุซ ุนู ุนูููุงุช ูู C:\Users\User\Desktop\
   โ ูุฌุฏ: python.exe (PID: 5678) โ
4. ุงููุชูุฌุฉ: Process: python.exe (PID: 5678)
```

### ุณููุงุฑูู 2: ุนูููุฉ ุชุนุฏู ูููุงุช ูุชุนุฏุฏุฉ
```
1. ููู 1: C:\Users\User\Documents\file1.txt
   โ ูุดู: python.exe (PID: 9999)
   โ ุญูุธ ูู ุงูุฐุงูุฑุฉ: Documents โ python.exe

2. ููู 2: C:\Users\User\Documents\file2.txt
   โ Method 1: ูุดู โ
   โ Method 2: ูุดู โ
   โ Method 3: ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ โ python.exe โ
```

---

## ุงูุนูููุงุช ุงููุดุจููุฉ ุงููุชุชุจุนุฉ

ุงููุธุงู ูุจุญุซ ุนู:
- โ `python.exe` / `pythonw.exe` (ุณูุฑูุจุชุงุช)
- โ `powershell.exe` (ุฃูุงูุฑ PowerShell)
- โ `cmd.exe` (ุฃูุงูุฑ Command Line)
- โ `wscript.exe` / `cscript.exe` (ุณูุฑูุจุชุงุช VBS)
- โ `mshta.exe` (HTML Applications)

ููุชุฌุงูู:
- โ ููุณู (`sami6`, `backend`)
- โ ุนูููุงุช ุงููุธุงู (`System`, `svchost.exe`)
- โ `explorer.exe` (ูุณุชูุดู Windows)

---

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### 1. ุฃุนุฏ ุชุดุบูู ุงููุธุงู
```bash
cd c:\Users\Remond\Desktop\sami6_V21
start.bat
```

### 2. ุดุบู ููุฑูุณ ุงุฎุชุจุงุฑู
```python
# test_virus.py
import os
import time

for i in range(20):
    with open(f'C:\\Users\\User\\Desktop\\test_{i}.txt', 'w') as f:
        f.write('encrypted data')
    time.sleep(0.1)
```

### 3. ุฑุงูุจ ุงููุชูุฌุฉ
ูุฌุจ ุฃู ุชุฑู:
```
๐จ RANSOMWARE THREAT DETECTED!
Process: python.exe (PID: XXXX)  โ โ ุงูุนูููุฉ ุงูุญููููุฉ!
Process Path: C:\...\python.exe
```

---

## ููุงุญุธุงุช ูููุฉ

### โก ุงูุฃุฏุงุก
- **Method 1**: ุณุฑูุน ููู ูุฏ ููุดู (ุงูุนูููุฉ ุชุบูู ุงูููู ุจุณุฑุนุฉ)
- **Method 2**: ุฃุจุทุฃ ููููุงู ููู ุฏููู (ููุญุต ุฌููุน ุงูุนูููุงุช)
- **Method 3**: ุณุฑูุน ุฌุฏุงู (ูุณุชุฎุฏู ุงูุฐุงูุฑุฉ)

### ๐ฏ ุงูุฏูุฉ
- **ูู ููุณ ุงููุฌูุฏ**: ุฏูุฉ 95%
- **ูุฌูุฏุงุช ูุฎุชููุฉ**: ุฏูุฉ 70%
- **ุนูููุงุช ูุชุนุฏุฏุฉ**: ูุฎุชุงุฑ ุงูุฃูุซุฑ ุงุญุชูุงูุงู

### ๐ ุงูุฃูุงู
- ูุณุชุซูู ุนูููุงุช ุงููุธุงู ุงูุญุฑุฌุฉ
- ูุชุฌุงูู ุนูููุฉ ุงููุฑุงูุจุฉ ููุณูุง
- ูุชุญูู ูู ูุฌูุฏ ุงูุนูููุฉ ูุจู ุงูุฅุฑุฌุงุน

---

## ุงูุฎุทูุฉ ุงูุชุงููุฉ

ุงูุขู ุจุนุฏ ุฅุตูุงุญ ูุดู ุงูุนูููุฉุ ุงููุธุงู ููููู:
1. โ **ุชุญุฏูุฏ ุงูููุฑูุณ ุจุฏูุฉ**
2. โ **ุฅููุงู ุงูุนูููุฉ ุงููุดุจููุฉ** (Containment)
3. โ **ุชุณุฌูู ูุนูููุงุช ุฏูููุฉ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ **ุนุฑุถ ุชูุจููุงุช ูุงุถุญุฉ** ูููุณุชุฎุฏู

๐ ุงููุธุงู ุฌุงูุฒ ูููุดู ุงูุฏููู!
